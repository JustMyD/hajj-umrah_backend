# Пример конфигурации PostgreSQL для продакшена
# Использование: скопируйте этот файл в postgresql.conf и смонтируйте в контейнер

# ============================================
# МОНИТОРИНГ И ПРОИЗВОДИТЕЛЬНОСТЬ
# ============================================

# pg_stat_statements - отслеживает статистику выполнения всех SQL запросов
# Включает расширение для мониторинга медленных запросов
shared_preload_libraries = 'pg_stat_statements'

# Включает сбор статистики по запросам
pg_stat_statements.track = all
pg_stat_statements.max = 10000

# ============================================
# ПАМЯТЬ
# ============================================

# Размер shared_buffers (рекомендуется 25% от RAM)
shared_buffers = 256MB

# Эффективная кэш-память (рекомендуется 50-75% от RAM)
effective_cache_size = 1GB

# Рабочая память для операций сортировки и хэш-таблиц
work_mem = 4MB

# Память для операций обслуживания (VACUUM, CREATE INDEX и т.д.)
maintenance_work_mem = 64MB

# ============================================
# ПРОИЗВОДИТЕЛЬНОСТЬ
# ============================================

# Максимальное количество одновременных подключений
max_connections = 100

# Логирование медленных запросов (в миллисекундах)
log_min_duration_statement = 1000

# Логирование всех запросов (для отладки, в продакшене обычно выключено)
# log_statement = 'all'

# ============================================
# БЕЗОПАСНОСТЬ
# ============================================

# Таймаут подключения
statement_timeout = 30000  # 30 секунд

# Максимальное количество подготовленных транзакций
max_prepared_transactions = 0

# ============================================
# ЛОГИРОВАНИЕ
# ============================================

# Формат логов
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Логирование ошибок и предупреждений
log_min_messages = warning

# Логирование времени выполнения запросов
log_duration = off
log_lock_waits = on


